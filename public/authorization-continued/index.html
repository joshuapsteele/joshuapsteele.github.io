<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Authorization, Continued: Experimenting with OpenFGA, Topaz, and Permify | Joshua P. Steele</title>
<meta name=keywords content="authorization"><meta name=description content="As I mentioned in my previous post, &ldquo;Devs, Let&rsquo;s Talk Authorization!&rdquo;, I&rsquo;m working on a new, exploratory work project related to authorization. Specifically, we&rsquo;re gathering authorization requirements from various orgs across our company and building 1-3 proofs-of-concept of a centralized, fine-grained approach to authorization. Right now, each org handles authorization in its own, usually coarse-grained and role-based way.
Clarify Current Requirements
The first thing I did was gather and clarify my org&rsquo;s current authorization model/requirements. We&rsquo;re heavily role-and-permission-based when it comes to authorization, with a touch of attribute-based access control mixed-in (to make sure that, for example, a user can only view resources related to their company, and not other companies). So, RBAC (role-based access control) with a bit of ABAC (attribute-based access control)."><meta name=author content="joshuapsteele"><link rel=canonical href=https://joshuapsteele.com/authorization-continued/><link crossorigin=anonymous href=/assets/css/stylesheet.1d3078ba3408f1410cbc7d07f412ada5ed26271bb27c7c601a7d46da382b440c.css integrity="sha256-HTB4ujQI8UEMvH0H9BKtpe0mJxuyfHxgGn1G2jgrRAw=" rel="preload stylesheet" as=style><link rel=icon href=https://joshuapsteele.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://joshuapsteele.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://joshuapsteele.com/favicon-32x32.png><link rel=apple-touch-icon href=https://joshuapsteele.com/apple-touch-icon.png><link rel=mask-icon href=https://joshuapsteele.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://joshuapsteele.com/authorization-continued/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://joshuapsteele.com/css/extended/custom.min.29813e946f92d51ad1f386ece6488324ef1119fbc7e73c5677ff6ccb8f4dfd82.css integrity="sha256-KYE+lG+S1RrR84bs5kiDJO8RGfvH5zxWd/9sy49N/YI="><link rel=preload href=https://joshuapsteele.com/images/default-social.png as=image><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//cdn.jsdelivr.net><meta property="og:type" content="article"><meta property="og:url" content="https://joshuapsteele.com/authorization-continued/"><meta property="og:title" content="Authorization, Continued: Experimenting with OpenFGA, Topaz, and Permify | Joshua P. Steele"><meta property="og:description" content="As I mentioned in my previous post, &ldquo;Devs, Let&rsquo;s Talk Authorization!&rdquo;, I&rsquo;m working on a new, exploratory work project related to authorization. Specifically, we&rsquo;re gathering authorization requirements from various orgs across our company and building 1-3 proofs-of-concept of a centralized, fine-grained approach to authorization. Right now, each org handles authorization in its own, usually coarse-grained and role-based way.
Clarify Current Requirements
The first thing I did was gather and clarify my org&rsquo;s current authorization model/requirements. We&rsquo;re heavily role-and-permission-based when it comes to authorization, with a touch of attribute-based access control mixed-in (to make sure that, for example, a user can only view resources related to their company, and not other companies). So, RBAC (role-based access control) with a bit of ABAC (attribute-based access control)."><meta property="og:image" content="https://joshuapsteele.com/images/default-social.png"><meta property="og:image:alt" content="Joshua P. Steele"><meta property="og:site_name" content="Joshua P. Steele"><meta name=twitter:card content="summary_large_image"><meta name=twitter:url content="https://joshuapsteele.com/authorization-continued/"><meta name=twitter:title content="Authorization, Continued: Experimenting with OpenFGA, Topaz, and Permify | Joshua P. Steele"><meta name=twitter:description content="As I mentioned in my previous post, &ldquo;Devs, Let&rsquo;s Talk Authorization!&rdquo;, I&rsquo;m working on a new, exploratory work project related to authorization. Specifically, we&rsquo;re gathering authorization requirements from various orgs across our company and building 1-3 proofs-of-concept of a centralized, fine-grained approach to authorization. Right now, each org handles authorization in its own, usually coarse-grained and role-based way.
Clarify Current Requirements
The first thing I did was gather and clarify my org&rsquo;s current authorization model/requirements. We&rsquo;re heavily role-and-permission-based when it comes to authorization, with a touch of attribute-based access control mixed-in (to make sure that, for example, a user can only view resources related to their company, and not other companies). So, RBAC (role-based access control) with a bit of ABAC (attribute-based access control)."><meta name=twitter:image content="https://joshuapsteele.com/images/default-social.png"><meta name=twitter:image:alt content="Joshua P. Steele"><meta property="article:published_time" content="2025-03-07T09:16:56-0500"><meta property="article:modified_time" content="2025-03-31T16:22:26-0400"><meta property="article:tag" content="authorization"><meta property="og:url" content="https://joshuapsteele.com/authorization-continued/"><meta property="og:site_name" content="Joshua P. Steele"><meta property="og:title" content="Authorization, Continued: Experimenting with OpenFGA, Topaz, and Permify"><meta property="og:description" content="As I mentioned in my previous post, ‚ÄúDevs, Let‚Äôs Talk Authorization!‚Äù, I‚Äôm working on a new, exploratory work project related to authorization. Specifically, we‚Äôre gathering authorization requirements from various orgs across our company and building 1-3 proofs-of-concept of a centralized, fine-grained approach to authorization. Right now, each org handles authorization in its own, usually coarse-grained and role-based way.
Clarify Current Requirements The first thing I did was gather and clarify my org‚Äôs current authorization model/requirements. We‚Äôre heavily role-and-permission-based when it comes to authorization, with a touch of attribute-based access control mixed-in (to make sure that, for example, a user can only view resources related to their company, and not other companies). So, RBAC (role-based access control) with a bit of ABAC (attribute-based access control)."><meta property="og:locale" content="en-US"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2025-03-07T09:16:56-05:00"><meta property="article:modified_time" content="2025-03-31T16:22:26-04:00"><meta property="article:tag" content="Authorization"><meta property="og:image" content="https://joshuapsteele.com/images/default-social.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://joshuapsteele.com/images/default-social.png"><meta name=twitter:title content="Authorization, Continued: Experimenting with OpenFGA, Topaz, and Permify"><meta name=twitter:description content="As I mentioned in my previous post, &ldquo;Devs, Let&rsquo;s Talk Authorization!&rdquo;, I&rsquo;m working on a new, exploratory work project related to authorization. Specifically, we&rsquo;re gathering authorization requirements from various orgs across our company and building 1-3 proofs-of-concept of a centralized, fine-grained approach to authorization. Right now, each org handles authorization in its own, usually coarse-grained and role-based way.
Clarify Current Requirements
The first thing I did was gather and clarify my org&rsquo;s current authorization model/requirements. We&rsquo;re heavily role-and-permission-based when it comes to authorization, with a touch of attribute-based access control mixed-in (to make sure that, for example, a user can only view resources related to their company, and not other companies). So, RBAC (role-based access control) with a bit of ABAC (attribute-based access control)."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Blogs","item":"https://joshuapsteele.com/blog/"},{"@type":"ListItem","position":2,"name":"Authorization, Continued: Experimenting with OpenFGA, Topaz, and Permify","item":"https://joshuapsteele.com/authorization-continued/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Authorization, Continued: Experimenting with OpenFGA, Topaz, and Permify","name":"Authorization, Continued: Experimenting with OpenFGA, Topaz, and Permify","description":"As I mentioned in my previous post, \u0026ldquo;Devs, Let\u0026rsquo;s Talk Authorization!\u0026rdquo;, I\u0026rsquo;m working on a new, exploratory work project related to authorization. Specifically, we\u0026rsquo;re gathering authorization requirements from various orgs across our company and building 1-3 proofs-of-concept of a centralized, fine-grained approach to authorization. Right now, each org handles authorization in its own, usually coarse-grained and role-based way.\nClarify Current Requirements The first thing I did was gather and clarify my org\u0026rsquo;s current authorization model/requirements. We\u0026rsquo;re heavily role-and-permission-based when it comes to authorization, with a touch of attribute-based access control mixed-in (to make sure that, for example, a user can only view resources related to their company, and not other companies). So, RBAC (role-based access control) with a bit of ABAC (attribute-based access control).\n","keywords":["authorization"],"articleBody":"As I mentioned in my previous post, ‚ÄúDevs, Let‚Äôs Talk Authorization!‚Äù, I‚Äôm working on a new, exploratory work project related to authorization. Specifically, we‚Äôre gathering authorization requirements from various orgs across our company and building 1-3 proofs-of-concept of a centralized, fine-grained approach to authorization. Right now, each org handles authorization in its own, usually coarse-grained and role-based way.\nClarify Current Requirements The first thing I did was gather and clarify my org‚Äôs current authorization model/requirements. We‚Äôre heavily role-and-permission-based when it comes to authorization, with a touch of attribute-based access control mixed-in (to make sure that, for example, a user can only view resources related to their company, and not other companies). So, RBAC (role-based access control) with a bit of ABAC (attribute-based access control).\nWhich Authorization Paradigm(s) Make the Most Sense? I then spent some time researching commonly used access control paradigms, in order to determine which approach would, in broad brushstrokes, be the best fit for our company going forward. Like I said, we‚Äôre currently RBAC with a touch of ABAC. But we‚Äôre already experiencing some role-bloat, and a centralized approach to authorization for our company needs to be more flexible and fine-grained than pure RBAC allows for.\nAn attribute-and-policy-based approach, such as that offered by Open Policy Agent (OPA), would be fine-grained enough for our current needs. And we‚Äôre experimenting with Topaz, which builds upon OPA and its Rego policy language, for one of our prototypes.\nHowever, because my org and others would like to be able to do more with organizational hierarchy when it comes to authorization, a relationship-based approach to access control (ReBAC), such as that offered by OpenFGA, is appealing!\nExperimenting with ReBAC in OpenFGA So, I‚Äôve spent some time modeling my org‚Äôs current authorization requirements using OpenFGA. As far as our current needs go, it was relatively easy to put together a fairly abstract authorization model in OpenFGA‚Äôs configuration language.\nHowever, it seems like a significant limitation to OpenFGA is that it does not evaluate indirect relationships recursively beyond one level of separation/indirection.\nAccording to OpenFGA‚Äôs documentation on ‚ÄúReferencing Relations on Related Objects‚Äù:\nOpenFGA does not allow the referenced relation (the word after from, also called the tupleset) to reference another relation and does not allow non-concrete types (type bound public access (:*) or usersets (#)) in its type restrictions; adding them throws a validation error when calling WriteAuthorizationModel.\nExample: Management Chain Authorization Consider a scenario where permissions should propagate up a management chain:\nObject A is owned by User B. User B is managed by User C. User C is managed by User D. ‚úÖ What OpenFGA Can Handle OpenFGA allows referencing relationships one level deep via X from Y.\nFor example, if an authorization model defines:\nallow manager from owner Then User C can inherit access to Object A because:\n‚ÄúUser C manages User B, who owns Object A.‚Äù\n‚ùå What OpenFGA Cannot Handle However, OpenFGA does not support evaluating this deeper chain:\n‚ÄúUser D should be able to view Object A, because User D manages User C, who manages User B, who owns Object A.‚Äù\nThis is because OpenFGA does not allow chaining references beyond one level.\nAnother warning of this limitation is found in OpenFGA‚Äôs documentation on modeling parent-child relationships:\nWhen searching tuples that are related to the object (the word after from, also called the tupleset), OpenFGA will not do any evaluation and only considers concrete objects (of the form :) that were directly assigned. OpenFGA will throw an error if it encounters any rewrites, a *, a type bound public access (:*), or a userset (:#).\nUPDATE: OpenFGA Does Handle Recursive Relationships! Shout-out to Raghd Hamzeh, who‚Äôs a part of the OpenFGA team, for helping me out with a solution to the management chain problem/example.\nRaghd writes:\nHey @steele!\nGood news! It does! :) Evaluating indirect relationships is one of @openfga ‚Äôs strong suites!\nLet me know what issue you‚Äôre facing or need clarification on and I can see if I can help\nYou‚Äôll find several examples on this and other use-cases in the OpenFGA sample stores repo: https://github.com/openfga/sample-stores/tree/main/stores\nHere‚Äôs the workaround/solution: splitting a manager relation into a manager and a can_manage relation!\nmodel schema 1.1 type user relations define manager: [user] define can_manage: manager or can_manage from manager type resource relations define owner: [user] define can_view: owner or can_manage from owner You can then assign a chain of management relationships via relational tuples:\ntuples: - user: user:B relation: owner object: resource:A - user: user:C relation: manager object: user:B - user: user:D relation: manager object: user:B The following test will pass:\ntests: - name: Tests check: - user: user:D object: resource:A assertions: can_view: true What Now? Experimenting with Permify (and SpiceDB, maybe) To be clear, it is possible to model multi-level management relationships, as well as intra-organization relationships across a large company, in OpenFGA. It just ends up taking more relational tuples to represent the relationships than I initially expected. (UPDATE: See above! It seems to either take more tuples than anticipated, OR splitting up the recursive relationship to allow for evaluation.)\nSo, I did some research on ReBAC and recursive relationships, and it sounds like other ReBAC solutions, like Permify and SpiceDB, can evaluate indirect relationships recursively. They avoid infinite loops and undue performance costs in various ways.\nI‚Äôm currently trying to translate the OpenFGA authorization model I created into Permify‚Äôs syntax. (Which, if anyone already has a tool or a script that does this, taking an .fga or an .fga.yaml file as input, please let me know!) I‚Äôll then put in some test data and run some checks to see if there are any noticeable differences between OpenFGA and Permify when it comes to performance, ‚Äúpain-in-the-ass‚Äù of development, etc.\nIf time allows, I‚Äôll also do some experimenting with SpiceDB. We‚Äôll see!\nAre you a software engineer who‚Äôs worked with tools like OpenFGA, Permify, and/or SpiceDB? If so, I‚Äôd love to make your acquaintance and hear your thoughts about these tools, authorization in general, etc.\nPlease send me an email at blog@joshuapsteele.com or reach out to me on BlueSky @joshuapsteele.bsky.social. Cheers!\n","wordCount":"1014","inLanguage":"en","image":"https://joshuapsteele.com/images/default-social.png","datePublished":"2025-03-07T09:16:56-05:00","dateModified":"2025-03-31T16:22:26-04:00","author":{"@type":"Person","name":"joshuapsteele"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://joshuapsteele.com/authorization-continued/"},"publisher":{"@type":"Organization","name":"Joshua P. Steele","logo":{"@type":"ImageObject","url":"https://joshuapsteele.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://joshuapsteele.com/ accesskey=h title="Joshua P. Steele (Alt + H)">Joshua P. Steele</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://joshuapsteele.com/about/ title=About><span>About</span></a></li><li><a href=https://joshuapsteele.com/blog/ title=Blog><span>Blog</span></a></li><li><a href=https://joshuapsteele.com/contact/ title=Contact><span>Contact</span></a></li><li><a href=https://joshuapsteele.com/resources/ title=Resources><span>Resources</span></a></li><li><a href=https://social.joshuapsteele.com title=Social><span>Social</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://joshuapsteele.com/search title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://joshuapsteele.com/>Home</a>&nbsp;¬ª&nbsp;<a href=https://joshuapsteele.com/blog/>Blogs</a></div><h1 class="post-title entry-hint-parent">Authorization, Continued: Experimenting with OpenFGA, Topaz, and Permify</h1><div class=post-meta><span title='2025-03-07 09:16:56 -0500 EST'>March 7, 2025</span>&nbsp;¬∑&nbsp;5 min&nbsp;¬∑&nbsp;joshuapsteele&nbsp;|&nbsp;<a href=https://github.com/joshuapsteele/joshuapsteele.github.io/tree/main/content/blog/authorization-continued.md rel="noopener noreferrer" target=_blank>View on GitHub</a>
<span class=post-meta-item><span class=post-meta-separator>|</span>
<button class=tinylytics_kudos data-path=/authorization-continued/></button></span></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#clarify-current-requirements aria-label="Clarify Current Requirements">Clarify Current Requirements</a></li><li><a href=#which-authorization-paradigms-make-the-most-sense aria-label="Which Authorization Paradigm(s) Make the Most Sense?">Which Authorization Paradigm(s) Make the Most Sense?</a></li><li><a href=#experimenting-with-rebac-in-openfga aria-label="Experimenting with ReBAC in OpenFGA">Experimenting with ReBAC in OpenFGA</a><ul><li><a href=#example-management-chain-authorization aria-label="Example: Management Chain Authorization">Example: Management Chain Authorization</a></li><li><a href=#-what-openfga-can-handle aria-label="‚úÖ What OpenFGA Can Handle">‚úÖ What OpenFGA Can Handle</a></li><li><a href=#-what-openfga-cannot-handle aria-label="‚ùå What OpenFGA Cannot Handle">‚ùå What OpenFGA Cannot Handle</a></li><li><a href=#update-openfga-does-handle-recursive-relationships aria-label="UPDATE: OpenFGA Does Handle Recursive Relationships!">UPDATE: OpenFGA Does Handle Recursive Relationships!</a></li></ul></li><li><a href=#what-now-experimenting-with-permify-and-spicedb-maybe aria-label="What Now? Experimenting with Permify (and SpiceDB, maybe)">What Now? Experimenting with Permify (and SpiceDB, maybe)</a></li></ul></div></details></div><div class=post-content><p>As I mentioned in my previous post, &ldquo;Devs, Let&rsquo;s Talk Authorization!&rdquo;, I&rsquo;m working on a new, exploratory work project related to authorization. Specifically, we&rsquo;re gathering authorization requirements from various orgs across our company and building 1-3 proofs-of-concept of a centralized, fine-grained approach to authorization. Right now, each org handles authorization in its own, usually coarse-grained and role-based way.</p><h2 id=clarify-current-requirements>Clarify Current Requirements<a hidden class=anchor aria-hidden=true href=#clarify-current-requirements>#</a></h2><p>The first thing I did was gather and clarify my org&rsquo;s current authorization model/requirements. We&rsquo;re heavily role-and-permission-based when it comes to authorization, with a touch of attribute-based access control mixed-in (to make sure that, for example, a user can only view resources related to their company, and not other companies). So, RBAC (role-based access control) with a bit of ABAC (attribute-based access control).</p><h2 id=which-authorization-paradigms-make-the-most-sense>Which Authorization Paradigm(s) Make the Most Sense?<a hidden class=anchor aria-hidden=true href=#which-authorization-paradigms-make-the-most-sense>#</a></h2><p>I then spent some time researching <a href=https://auth0.com/blog/an-overview-of-commonly-used-access-control-paradigms/>commonly used access control paradigms</a>, in order to determine which approach would, in broad brushstrokes, be the best fit for our company going forward. Like I said, we&rsquo;re currently RBAC with a touch of ABAC. But we&rsquo;re already experiencing some role-bloat, and a centralized approach to authorization for our company needs to be more flexible and fine-grained than pure RBAC allows for.</p><p>An attribute-and-policy-based approach, such as that offered by <a href=https://www.openpolicyagent.org/>Open Policy Agent (OPA)</a>, would be fine-grained enough for our current needs. And we&rsquo;re experimenting with <a href=https://www.topaz.sh/docs/intro>Topaz</a>, which builds upon OPA and its Rego policy language, for one of our prototypes.</p><p>However, because my org and others would like to be able to do more with organizational hierarchy when it comes to authorization, a relationship-based approach to access control (ReBAC), such as that offered by <a href=https://openfga.dev/>OpenFGA</a>, is appealing!</p><h2 id=experimenting-with-rebac-in-openfga>Experimenting with ReBAC in OpenFGA<a hidden class=anchor aria-hidden=true href=#experimenting-with-rebac-in-openfga>#</a></h2><p>So, I&rsquo;ve spent some time modeling my org&rsquo;s current authorization requirements using OpenFGA. As far as our current needs go, it was relatively easy to put together a fairly abstract authorization model in OpenFGA&rsquo;s configuration language.</p><p>However, it seems like a significant limitation to OpenFGA is that it does not evaluate indirect relationships recursively beyond one level of separation/indirection.</p><p>According to OpenFGA‚Äôs documentation on <a href=https://openfga.dev/docs/configuration-language#referencing-relations-on-related-objects>&ldquo;Referencing Relations on Related Objects&rdquo;</a>:</p><blockquote><p>OpenFGA does not allow the referenced relation (the word after <code>from</code>, also called the tupleset) to reference another relation and does not allow non-concrete types (type bound public access (<code>&lt;object_type>:*</code>) or usersets (<code>&lt;object_type>#&lt;relation></code>)) in its type restrictions; adding them throws a validation error when calling <code>WriteAuthorizationModel</code>.</p></blockquote><h3 id=example-management-chain-authorization>Example: Management Chain Authorization<a hidden class=anchor aria-hidden=true href=#example-management-chain-authorization>#</a></h3><p>Consider a scenario where permissions should propagate up a management chain:</p><ol><li><strong>Object A</strong> is <strong>owned</strong> by <strong>User B</strong>.</li><li><strong>User B</strong> is <strong>managed</strong> by <strong>User C</strong>.</li><li><strong>User C</strong> is <strong>managed</strong> by <strong>User D</strong>.</li></ol><h3 id=-what-openfga-can-handle>‚úÖ What OpenFGA <em>Can</em> Handle<a hidden class=anchor aria-hidden=true href=#-what-openfga-can-handle>#</a></h3><p>OpenFGA allows referencing relationships <strong>one level deep</strong> via <code>X from Y</code>.</p><p>For example, if an authorization model defines:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>allow manager from owner
</span></span></code></pre></div><p>Then <strong>User C</strong> can inherit access to <strong>Object A</strong> because:</p><blockquote><p>&ldquo;User C manages User B, who owns Object A.&rdquo;</p></blockquote><h3 id=-what-openfga-cannot-handle>‚ùå What OpenFGA <em>Cannot</em> Handle<a hidden class=anchor aria-hidden=true href=#-what-openfga-cannot-handle>#</a></h3><p>However, OpenFGA <strong>does not</strong> support evaluating this deeper chain:</p><blockquote><p>&ldquo;User D should be able to view Object A, because User D manages User C, who manages User B, who owns Object A.&rdquo;</p></blockquote><p>This is because OpenFGA <strong>does not allow chaining references beyond one level</strong>.</p><p>Another warning of this limitation is found in <a href=https://openfga.dev/docs/modeling/parent-child#05-check-if-bob-is-an-editor-of-documentmeeting_notesdoc>OpenFGA‚Äôs documentation on modeling parent-child relationships</a>:</p><blockquote><p>When searching tuples that are related to the object (the word after <code>from</code>, also called the tupleset), OpenFGA will not do any evaluation and only considers concrete objects (of the form <code>&lt;object_type>:&lt;object_id></code>) that were directly assigned. OpenFGA will throw an error if it encounters any rewrites, a <code>*</code>, a type bound public access (<code>&lt;object_type>:*</code>), or a userset (<code>&lt;object_type>:&lt;object_id>#&lt;relation></code>).</p></blockquote><h3 id=update-openfga-does-handle-recursive-relationships>UPDATE: OpenFGA Does Handle Recursive Relationships!<a hidden class=anchor aria-hidden=true href=#update-openfga-does-handle-recursive-relationships>#</a></h3><p>Shout-out to <a href=https://social.rhamzeh.com/@raghd>Raghd Hamzeh</a>, who&rsquo;s a part of the <a href=https://mastodon.social/@openfga>OpenFGA</a> team, for helping me out with a solution to the management chain problem/example.</p><p><a href=https://social.lol/@raghd@rhamzeh.com/114123110921262312>Raghd writes</a>:</p><blockquote><p>Hey @steele!<br>Good news! It does! :) Evaluating indirect relationships is one of @openfga &rsquo;s strong suites!<br>Let me know what issue you&rsquo;re facing or need clarification on and I can see if I can help<br>You&rsquo;ll find several examples on this and other use-cases in the OpenFGA sample stores repo: <a href=https://github.com/openfga/sample-stores/tree/main/stores>https://github.com/openfga/sample-stores/tree/main/stores</a></p></blockquote><p>Here&rsquo;s the workaround/solution: splitting a <code>manager</code> relation into a <code>manager</code> and a <code>can_manage</code> relation!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>model
</span></span><span style=display:flex><span>  schema 1.1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>type user
</span></span><span style=display:flex><span>  relations
</span></span><span style=display:flex><span>    define manager: [user]
</span></span><span style=display:flex><span>    define can_manage: manager or can_manage from manager
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>type resource
</span></span><span style=display:flex><span>  relations
</span></span><span style=display:flex><span>    define owner: [user]
</span></span><span style=display:flex><span>    define can_view: owner or can_manage from owner
</span></span></code></pre></div><p>You can then assign a chain of management relationships via relational tuples:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>tuples</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>user</span>: <span style=color:#ae81ff>user:B</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>relation</span>: <span style=color:#ae81ff>owner</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>object</span>: <span style=color:#ae81ff>resource:A</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>user</span>: <span style=color:#ae81ff>user:C</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>relation</span>: <span style=color:#ae81ff>manager</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>object</span>: <span style=color:#ae81ff>user:B</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>user</span>: <span style=color:#ae81ff>user:D</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>relation</span>: <span style=color:#ae81ff>manager</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>object</span>: <span style=color:#ae81ff>user:B</span>
</span></span></code></pre></div><p>The following test will pass:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>tests</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Tests</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>check</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>user</span>: <span style=color:#ae81ff>user:D</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>object</span>: <span style=color:#ae81ff>resource:A</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>assertions</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>can_view</span>: <span style=color:#66d9ef>true</span>
</span></span></code></pre></div><h2 id=what-now-experimenting-with-permify-and-spicedb-maybe>What Now? Experimenting with Permify (and SpiceDB, maybe)<a hidden class=anchor aria-hidden=true href=#what-now-experimenting-with-permify-and-spicedb-maybe>#</a></h2><p>To be clear, it is possible to model multi-level management relationships, as well as intra-organization relationships across a large company, in OpenFGA. It just ends up taking more relational tuples to represent the relationships than I initially expected. (UPDATE: See above! It seems to either take more tuples than anticipated, OR splitting up the recursive relationship to allow for evaluation.)</p><p>So, I did some research on ReBAC and recursive relationships, and it sounds like other ReBAC solutions, like Permify and SpiceDB, can evaluate indirect relationships recursively. They avoid infinite loops and undue performance costs in various ways.</p><p>I&rsquo;m currently trying to translate the OpenFGA authorization model I created into Permify&rsquo;s syntax. (Which, if anyone already has a tool or a script that does this, taking an <code>.fga</code> or an <code>.fga.yaml</code> file as input, please let me know!) I&rsquo;ll then put in some test data and run some checks to see if there are any noticeable differences between OpenFGA and Permify when it comes to performance, &ldquo;pain-in-the-ass&rdquo; of development, etc.</p><p>If time allows, I&rsquo;ll also do some experimenting with SpiceDB. We&rsquo;ll see!</p><hr><p>Are you a software engineer who&rsquo;s worked with tools like OpenFGA, Permify, and/or SpiceDB? If so, I&rsquo;d love to make your acquaintance and hear your thoughts about these tools, authorization in general, etc.</p><p>Please send me an email at <a href=mailto:blog@joshuapsteele.com>blog@joshuapsteele.com</a> or reach out to me on <a href=https://bsky.app/profile/joshuapsteele.bsky.social>BlueSky @joshuapsteele.bsky.social</a>. Cheers!</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://joshuapsteele.com/tags/authorization/>Authorization</a></li></ul></div><nav class=paginav><a class=prev href=https://joshuapsteele.com/bonhoeffer-on-stupidity/><span class=title>¬´ Prev</span><br><span>Bonhoeffer on Stupidity</span>
</a><a class=next href=https://joshuapsteele.com/this-shouldnt-be-controversial/><span class=title>Next ¬ª</span><br><span>This Shouldn't Be Controversial</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Authorization, Continued: Experimenting with OpenFGA, Topaz, and Permify on x" href="https://x.com/intent/tweet/?text=Authorization%2c%20Continued%3a%20Experimenting%20with%20OpenFGA%2c%20Topaz%2c%20and%20Permify&amp;url=https%3a%2f%2fjoshuapsteele.com%2fauthorization-continued%2f&amp;hashtags=authorization"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Authorization, Continued: Experimenting with OpenFGA, Topaz, and Permify on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fjoshuapsteele.com%2fauthorization-continued%2f&amp;title=Authorization%2c%20Continued%3a%20Experimenting%20with%20OpenFGA%2c%20Topaz%2c%20and%20Permify&amp;summary=Authorization%2c%20Continued%3a%20Experimenting%20with%20OpenFGA%2c%20Topaz%2c%20and%20Permify&amp;source=https%3a%2f%2fjoshuapsteele.com%2fauthorization-continued%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Authorization, Continued: Experimenting with OpenFGA, Topaz, and Permify on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fjoshuapsteele.com%2fauthorization-continued%2f&title=Authorization%2c%20Continued%3a%20Experimenting%20with%20OpenFGA%2c%20Topaz%2c%20and%20Permify"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Authorization, Continued: Experimenting with OpenFGA, Topaz, and Permify on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fjoshuapsteele.com%2fauthorization-continued%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Authorization, Continued: Experimenting with OpenFGA, Topaz, and Permify on whatsapp" href="https://api.whatsapp.com/send?text=Authorization%2c%20Continued%3a%20Experimenting%20with%20OpenFGA%2c%20Topaz%2c%20and%20Permify%20-%20https%3a%2f%2fjoshuapsteele.com%2fauthorization-continued%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Authorization, Continued: Experimenting with OpenFGA, Topaz, and Permify on telegram" href="https://telegram.me/share/url?text=Authorization%2c%20Continued%3a%20Experimenting%20with%20OpenFGA%2c%20Topaz%2c%20and%20Permify&amp;url=https%3a%2f%2fjoshuapsteele.com%2fauthorization-continued%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Authorization, Continued: Experimenting with OpenFGA, Topaz, and Permify on ycombinator" href="https://news.ycombinator.com/submitlink?t=Authorization%2c%20Continued%3a%20Experimenting%20with%20OpenFGA%2c%20Topaz%2c%20and%20Permify&u=https%3a%2f%2fjoshuapsteele.com%2fauthorization-continued%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer><div class=lets-talk-section><hr><h2>Let's Talk</h2><div class=post-reply-buttons><a href="mailto:blog@joshuapsteele.com?subject=Re: Authorization%2c%20Continued%3a%20Experimenting%20with%20OpenFGA%2c%20Topaz%2c%20and%20Permify" class=reply-button>üìß Reply via email
</a><a href="https://bsky.app/intent/compose?text=%40joshuapsteele.bsky.social+Re%3A+Authorization%2C+Continued%3A+Experimenting+with+OpenFGA%2C+Topaz%2C+and+Permify+https%3A%2F%2Fjoshuapsteele.com%2Fauthorization-continued%2F" class=reply-button>ü¶ã Reply via Bluesky
</a><a href="https://micro.blog/post?text=@joshuapsteele Re: Authorization%2c%20Continued%3a%20Experimenting%20with%20OpenFGA%2c%20Topaz%2c%20and%20Permify https%3a%2f%2fjoshuapsteele.com%2fauthorization-continued%2f" class=reply-button>üåê Reply via Micro.blog</a></div><hr></div></article></main><script src=https://tinylytics.app/embed/kLx6jW19SrdcVTjNny3p.js?hits&countries&kudos defer></script><footer class=footer><span>&copy; 2025 <a href=https://joshuapsteele.com/>Joshua P. Steele</a></span><br>Navigate my <a href=/blog>blog</a> by <a href=/categories>categories</a> and <a href=/tags>tags</a><br><span>Find me on
<a href=https://social.joshuapsteele.com/ target=_blank>micro.blog</a> &
        <a href=https://steele.omg.lol/ target=_blank>omg.lol</a></span><br><span><span class=tinylytics_hits></span> visits from the following countries:</span><br><span class=tinylytics_countries></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>